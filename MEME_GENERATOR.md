# ¬´–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –º–µ–º–æ–≤¬ª

¬´–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –º–µ–º–æ–≤¬ª ‚Äî —Ç–≤–æ–π –∫–∞—Ä–º–∞–Ω–Ω—ã–π –º–∞—Å—Ç–µ—Ä –ø–æ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤—É —Å–º–µ—Ö–∞! –í—ã–±–µ—Ä–∏ –∫–∞—Ä—Ç–∏–Ω–∫—É, –¥–æ–±–∞–≤—å —Ç–µ–∫—Å—Ç –∏ –≤—É–∞–ª—è! ‚Äî —É —Ç–µ–±—è –º–µ–º, —Å–ø–æ—Å–æ–±–Ω—ã–π —Ä–∞–∑–±—É–¥–∏—Ç—å –¥–∞–∂–µ —Å–ø—è—â–µ–≥–æ –∫–æ—Ç–∞! üòõ 

üí° –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è:
- –£–Ω–∏–∂–µ–Ω–∏–π –≤ –≥—Ä—É–ø–ø–æ–≤–æ–º —á–∞—Ç–µ,
- –í–µ—á–µ—Ä–Ω–∏—Ö –ø–æ—Å–∏–¥–µ–ª–æ–∫ —Å –Ω–æ—É—Ç–æ–º –∏ –ø–µ—á–µ–Ω—å–∫–∞–º–∏,
- –†–∞–±–æ—Ç—ã (–µ—Å–ª–∏ –≤—ã SMM-—â–∏–∫, –∫–æ–Ω–µ—á–Ω–æüòè).

–°–æ–∑–¥–∞–≤–∞–π, —Å–º–µ–π—Å—è, –¥–µ–ª–∏—Å—å.

## –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

–ë–æ—Ç –¥–æ–ª–∂–µ–Ω –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –º–µ–º—ã, –∏—Å–ø–æ–ª—å–∑—É—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ —Ç–µ–∫—Å—Ç. –î–ª—è —ç—Ç–æ–≥–æ –æ–Ω –±–µ—Ä—ë—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏ —Ä–∏—Å—É–µ—Ç –Ω—É–∂–Ω—ã–π —Ç–µ–∫—Å—Ç –≤–Ω–∏–∑—É —ç—Ç–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–ø—Ä–∏–º–µ—Ä –Ω–∏–∂–µ).

![meme.jpg](misc/meme_example.jpg)

**–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:** –±–æ—Ç –¥–æ–ª–∂–µ–Ω –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—É `/generate`, –∫–æ—Ç–æ—Ä–∞—è –∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –º–µ–º—ã (–≤ –∏—Ç–æ–≥–µ –±–æ—Ç –ø—Ä–∏—Å—ã–ª–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º). –ë–æ—Ç –¥–æ–ª–∂–µ–Ω —Å–ø—Ä–æ—Å–∏—Ç—å —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∫–∞–∫–æ–π —Ç–µ–∫—Å—Ç –≤–ø–∏—Å–∞—Ç—å –≤ –º–µ–º.

***–£—Ä–æ–≤–Ω–∏ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏***:
1. *Easy*. –ë–æ—Ç —Ä–∞–Ω–¥–æ–º–Ω–æ –≤—ã–±–∏—Ä–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–∑ —Å–≤–æ–µ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.
2. *Medium*. –ë–æ—Ç –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤—ã–±—Ä–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏.
3. *Advanced*. –ë–æ—Ç –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –∑–∞–≥—Ä—É–∂–∞—Ç—å —Å–≤–æ–∏ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏.
4. *Advanced+*. –ë–æ—Ç –ø–æ–∑–≤–æ–ª—è–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑–º–µ—Ä —Ç–µ–∫—Å—Ç–∞ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏, –æ—Ç—Å—Ç—É–ø —Å–Ω–∏–∑—É, —à—Ä–∏—Ñ—Ç –∏ —Ü–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞.

## –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

### –†–∞–±–æ—Ç–∞ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏

–ë–æ—Ç –¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –Ω–∞ –¥–∏—Å–∫–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –ø–∞–ø–∫—É `memes` –ø—Ä—è–º–æ –≤ –ø—Ä–æ–µ–∫—Ç PyCharm).

–ï—Å–ª–∏ –±–æ—Ç –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –∑–∞–≥—Ä—É–∂–∞—Ç—å —Å–≤–æ–∏ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, —Ç–æ –æ–Ω –¥–æ–ª–∂–µ–Ω —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –∏—Ö –≤—Å–µ –ª–∏–±–æ –≤ –¥—Ä—É–≥—É—é –æ–±—â—É—é –ø–∞–ø–∫—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, `downloads`), –ª–∏–±–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø–æ–¥ –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å–≤–æ—é —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—É—é –ø–∞–ø–∫—É (—Ç–æ–≥–¥–∞ –ø–∞–ø–∫—É –º–æ–∂–Ω–æ –∏–º–µ–Ω–æ–≤–∞—Ç—å –∫–∞–∫ `user-$id`, –Ω–∞–ø—Ä–∏–º–µ—Ä: `user-619700989`).

–î–ª—è —Ä–∞–±–æ—Ç—ã —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–π —Ñ—Ä–∞–≥–º–µ–Ω—Ç –∫–æ–¥–∞:

```python
import os
from pathlib import Path
from typing import Optional

import aiofiles
from aiogram.client.session import aiohttp



async def download_photo(
        downloads_folder_path: str,
        file_path: str,
        session: aiohttp.ClientSession,
) -> str:
    __ensure_directory_exists(downloads_folder_path)

    p = Path(file_path)
    path = f"{downloads_folder_path}/{p.name}"

    async with session.get(file_path) as resp:
        if resp.status == 200:
            f = await aiofiles.open(path, mode='wb')
            await f.write(await resp.read())
            await f.close()

    return path


def get_meme_list(meme_folder_path: str) -> str:
    __ensure_directory_exists(meme_folder_path)

    result = ""

    for f in os.listdir(meme_folder_path):
        p = Path(f)
        result += f"{p.stem}\n\n"

    return result


def find_meme(meme_folder_path: str, meme_name: str) -> Optional[str]:
    __ensure_directory_exists(meme_folder_path)

    for f in os.listdir(meme_folder_path):
        p = Path(f)
        if p.stem.lower() == meme_name.lower():
            return f"{meme_folder_path}/{f}"

    return None


def __ensure_directory_exists(path: str) -> None:
    if not os.path.exists(path):
        os.makedirs(path)
```

–ò–∑ –¥–∞–Ω–Ω–æ–≥–æ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞ –∫–æ–¥–∞ –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏:
- `download_photo()` ‚Äî —Å–∫–∞—á–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è,
- `get_meme_list()` ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –≤—Å–µ—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–µ–º–æ–≤ –∏–∑ –ø–∞–ø–∫–∏,
- `find_meme()` ‚Äî –ø–æ–∏—Å–∫ –º–µ–º–∞ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é (–ª–∏–±–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É, –ª–∏–±–æ `None`).

–î–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å 2 –≤–µ—â–∏. –í–æ-–ø–µ—Ä–≤—ã—Ö, –≤ —Ñ–∞–π–ª–µ `bot.py` –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–∑–¥–∞—Ç—å –æ–±—ä–µ–∫—Ç `session`, —á—Ç–æ–±—ã –ø–æ—Ç–æ–º –µ–≥–æ –≤–µ–∑–¥–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:

```python
dp = Dispatcher()
...

async def main() -> None:
    ...
dp["session"] = aiohttp.ClientSession(
    base_url=f"https://api.telegram.org/file/bot{BOT_TOKEN}/",
)
```

> –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫—É –º–æ–∂–Ω–æ —Å –ø–æ–º–æ—â—å—é `pip install aiohttp`

–í–æ-–≤—Ç–æ—Ä—ã—Ö, —á—Ç–æ–±—ã —Å–∫–∞—á–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è, –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å —Å–ª–µ–¥—É—é—â–µ–µ:

```python
photo = message.photo[-1].file_id

photo_file = await bot.get_file(photo)

output_path = await download_photo(
    file_path=photo_file.file_path,
    session=...,
    downloads_folder_path=...,
)
```

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–µ–º–æ–≤

–î–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –º–µ–º–æ–≤ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `generate_meme()` –∏–∑ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞ –∫–æ–¥–∞ –Ω–∏–∂–µ. –î–∞–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ, –∞ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
- **image_path** ‚Äî –ø—É—Ç—å –∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é (–Ω–∞–ø—Ä–∏–º–µ—Ä, "./memes/meme-1.jpg"),
- **label** ‚Äî —Ç–µ–∫—Å—Ç –º–µ–º–∞,
- **font_family** ‚Äî —à—Ä–∏—Ñ—Ç —Ç–µ–∫—Å—Ç–∞ (–º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ—Ä–∞–≥–º–µ–Ω—Ç –∫–æ–¥–∞ –Ω–∏–∂–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤—Å–µ—Ö –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º —Å–∏—Å—Ç–µ–º–æ–π —à—Ä–∏—Ñ—Ç–æ–≤). P.S. –ù–µ –≤—Å–µ —à—Ä–∏—Ñ—Ç—ã –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç —Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫(
- **font_size** ‚Äî —Ä–∞–∑–º–µ—Ä —Ç–µ–∫—Å—Ç–∞ –≤ –∫–∞–∫–∏—Ö-—Ç–æ —É—Å–ª–æ–≤–Ω—ã—Ö –µ–¥–∏–Ω–∏—Ü–∞—Ö,
- **color** ‚Äî —Ü–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞, —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ —Ç—Ä—ë—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç (red, green, blue), –∫–∞–∂–¥–∞—è —Å–æ –∑–Ω–∞—á–µ–Ω–∏–µ–º –æ—Ç 0 –¥–æ 255.
  - **(0, 0, 0)** ‚Äî —á—ë—Ä–Ω—ã–π,
  - **(255, 255, 255)** ‚Äî –±–µ–ª—ã–π,
  - **(255, 0, 0)** ‚Äî –∫—Ä–∞—Å–Ω—ã–π,
  - –∏ —Ç.–¥.
- **bottom_indent_perc** ‚Äî –æ—Ç—Å—Ç—É–ø —Ç–µ–∫—Å—Ç–∞ —Å–Ω–∏–∑—É –≤ —É—Å–ª–æ–≤–Ω—ã—Ö –µ–¥–∏–Ω–∏—Ü–∞—Ö, 
- **out_format** ‚Äî —Ñ–æ—Ä–º–∞—Ç –∏—Ç–æ–≥–æ–≤–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.

```python
from io import BytesIO

from PIL import Image, ImageFont, ImageDraw


def generate_meme(
        image_path: str,
        label: str,
        font_family: str = "DejaVuSans.ttf",
        font_size: int = 55,
        color: tuple[int, int, int] = None,
        bottom_indent_perc: int = 7,
        out_format: str = "WEBP",
) -> BytesIO:

    if color is None:
        color = (0, 0, 0)

    buffer = BytesIO()

    with Image.open(image_path) as im:
        unicode_font = ImageFont.truetype(font_family, font_size)
        xy = (im.size[0] // 2, im.size[1] - bottom_indent_perc * im.size[1] // 100)
        ImageDraw.Draw(im).text(
            xy=xy,
            text=label,
            fill=color,
            font=unicode_font,
            anchor="mm",
        )
        im.save(fp=buffer, format=out_format)

    buffer.seek(0)

    return buffer
```
> –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫—É –º–æ–∂–Ω–æ —Å –ø–æ–º–æ—â—å—é `pip install pillow`



```python
from matplotlib import font_manager


for n in font_manager.get_font_names():
    print(n)
```
> –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫—É –º–æ–∂–Ω–æ —Å –ø–æ–º–æ—â—å—é `pip install matplotlib`


–ß—Ç–æ–±—ã –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –º–µ–º –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–π —Ñ—Ä–∞–≥–º–µ–Ω—Ç –∫–æ–¥–∞:

```python
from aiogram.types import BufferedInputFile


meme = generate_meme(...)

await message.answer_photo(
        BufferedInputFile(
            meme.read(),
            filename="–ø—Ä–∏–¥—É–º–∞—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ",
        ),
    )
```

### –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º—ã–π —Å–æ—Å—Ç–∞–≤ –∫–æ–º–∞–Ω–¥—ã –∏ —Ä–æ–ª–∏

–í—Å—ë –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —É—Ä–æ–≤–Ω—è —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ (–∏–ª–∏ —É—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –æ—Ç —Å–æ—Å—Ç–∞–≤–∞ –∫–æ–º–∞–Ω–¥—ã ‚Äî –ø–æ–∫–∞ –Ω–µ —Ä–µ—à–∏–ª). –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º—ã–µ —Ä–æ–ª–∏ –¥–ª—è —É—Ä–æ–≤–Ω—è *Advanced+*:
- 1 —á–µ–ª–æ–≤–µ–∫ –∑–∞–Ω–∏–º–∞–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏–µ–π –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –º–µ–º–æ–≤ (–ø—Ä–æ–≤–µ—Ä–∫–∞ –µ—ë —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏, –ø–æ–¥–∫—Ä—É—á–∏–≤–∞–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏ —Ç.–¥.),
- 1 —á–µ–ª–æ–≤–µ–∫ –∑–∞–Ω–∏–º–∞–µ—Ç—Å—è —Ä–∞–±–æ—Ç–æ–π —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ (—Å–∫–∞—á–∏–≤–∞–Ω–∏–µ, –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏ —Ç.–¥.),
- 2 —á–µ–ª–æ–≤–µ–∫–∞ –∑–∞–Ω–∏–º–∞—é—Ç—Å—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞–º–∏.
